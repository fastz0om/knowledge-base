---
created: 2025-01-27
tags: [linux, administration, lvm, ssh, gpg, ntp, git]
category: infrastructure
---

# Администрирование Linux системы

## Обзор

Типовые задачи системного администрирования: управление LVM, SSH ключи, GPG, NTP, операции с Git и история команд.

## Управление LVM

### Изменение размера логического тома LVM

Пошаговый процесс расширения логического тома:

```bash
# 1. Проверить текущее использование диска
df -h

# 2. Проверить блочные устройства и разделы
lsblk

# 3. Проверить информацию о группе томов
vgdisplay

# 4. Изменить размер раздела (интерактивно)
parted /dev/sda
    print          # Показать таблицу разделов
    resizepart 3 100%  # Изменить размер раздела 3 до 100% доступного пространства
    quit

# 5. Изменить размер физического тома
pvresize /dev/sda3

# 6. Расширить логический том
lvextend -l +100%FREE /dev/mapper/ubuntu--vg-ubuntu--lv

# 7. Изменить размер файловой системы
resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv

# 8. Проверить новый размер
df -h
```

**Примечания:**
- Убедитесь, что раздел имеет свободное пространство перед изменением размера
- Для файловых систем XFS используйте `xfs_growfs` вместо `resize2fs`
- Всегда делайте резервную копию критических данных перед изменением размера

## Управление SSH ключами

### Генерация SSH ключа для Jenkins агента

```bash
# Сгенерировать ED25519 ключ (рекомендуется)
ssh-keygen -t ed25519 -b 4096

# Добавить публичный ключ в authorized_keys
cat .ssh/id_ed25519.pub >> .ssh/authorized_keys

# Установить правильные права доступа
chmod 600 .ssh/authorized_keys

# Показать ключи для проверки
cat .ssh/id_ed25519*
```

**Рекомендации:**
- Используйте ключи ED25519 (более безопасны и быстрее, чем RSA)
- Никогда не передавайте приватные ключи
- Используйте парольную фразу для дополнительной безопасности
- Регулярно меняйте ключи

## Управление GPG ключами

### Создание и экспорт GPG ключей

```bash
# Сгенерировать новый GPG ключ
gpg --gen-key

# Экспортировать публичный ключ (ASCII формата)
gpg --armor --output public.gpg.key --export

# Экспортировать приватный ключ (ASCII формата)
gpg --armor --output private.gpg.key --export-secret-key
```

**Email:** test.rt@example.ru

**Использование:**
- Публичный ключ: передавать для шифрования/проверки
- Приватный ключ: хранить в безопасности, никогда не передавать
- Использовать ASCII формат для удобной передачи по email/тексту

## Конфигурация NTP

### Настройка Chrony

Добавить NTP сервер в `/etc/chrony/chrony.conf`:

```
server 10.199.11.2 iburst
```

**Опции:**
- `iburst` - Отправить пакетную передачу для более быстрой первоначальной синхронизации

**Перезагрузить chrony:**
```bash
systemctl reload chronyd
chronyc sources  # Проверить статус синхронизации
```

## Операции с Git

### Зеркалирование репозитория

Полезно для создания точной копии репозитория (включая все ссылки):

```bash
# Клонировать репозиторий как зеркало
git clone --mirror own_gitlab_repo_url

# Изменить URL удаленного репозитория
cd path_to_repo
git remote set-url origin our_gitlab_repo_url

# Отправить всё (все ветки, теги и т.д.)
git push --mirror
```

### Удаление старых Git тегов

Удалить старые теги, оставив недавние:

```bash
# Проверить текущий статус
git status
git pull

# Получить старые теги (первые 100, отсортированные по дате создания)
tags=$(git for-each-ref --sort=creatordate --format '%(refname:short)' refs/tags | head -n 100)

# Проверить теги (опционально)
echo $tags

# Проверить дату тега (опциональная проверка)
git checkout ${RANDOM_TAG}
git log -n1  # Проверить дату
git checkout master

# Удалить теги локально и удаленно
for tag in $tags; do
  git tag -d "$tag"
done
git push origin --delete $tags
```

**Предупреждение:** Убедитесь, что хотите удалить эти теги - это действие нельзя легко отменить!

## Операции поиска

### Поиск в множестве файлов

```bash
# Поиск паттерна в файлах текущего каталога, показать имя файла
grep ./* -e "BRANCH" -H
```

**Опции:**
- `-e` - Паттерн для поиска
- `-H` - Всегда печатать имя файла
- `-r` - Рекурсивный поиск
- `-i` - Без учета регистра

## История команд оболочки

### Очистка истории команд

```bash
history -c && history -w
```

**Команды:**
- `history -c` - Очистить историю в памяти
- `history -w` - Записать (пустую) историю в файл, перезаписав существующий

## Связанные заметки

- [[Kernel Management]]
- [[Package Management]]

